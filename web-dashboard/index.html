<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AutoApply - Dashboard</title>
  <meta name="description" content="Gestiona tu CV y aplica a trabajos autom√°ticamente con AutoApply">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/stepper.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div class="logo">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" fill="currentColor"/>
            <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2"/>
            <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2"/>
          </svg>
          <h1>AutoApply</h1>
        </div>
        
        <nav class="nav">
          <a href="#dashboard" class="nav-link active">Dashboard</a>
          <a href="#profile" class="nav-link">Mi Perfil</a>
          <a href="#upload" class="nav-link">Subir CV</a>
        </nav>

        <div class="header-actions">
          <button class="btn btn-secondary" id="installExtension">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2"/>
              <path d="M7 10L12 15L17 10" stroke="currentColor" stroke-width="2"/>
              <path d="M12 15V3" stroke="currentColor" stroke-width="2"/>
            </svg>
            Instalar Extensi√≥n
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <div class="container">
      <!-- Welcome Section -->
      <section id="dashboard" class="section">
        
        <!-- STEPPER -->
        <div class="stepper-wrapper">
          <div class="stepper-item completed" id="step1-indicator">
            <div class="step-counter">1</div>
            <div class="step-name">Subir CV</div>
          </div>
          <div class="stepper-item" id="step2-indicator">
            <div class="step-counter">2</div>
            <div class="step-name">Verificar Datos</div>
          </div>
          <div class="stepper-item" id="step3-indicator">
            <div class="step-counter">3</div>
            <div class="step-name">Perfiles IA</div>
          </div>
        </div>

        <!-- PASO 1: SUBIR CV -->
        <div id="step1-content" class="step-content">
          <div class="text-center mb-4">
            <h2>Comienza tu Viaje üöÄ</h2>
            <p>Sube tu CV en PDF para extraer toda tu informaci√≥n autom√°ticamente.</p>
          </div>
          
          <div class="upload-area-large" id="uploadArea">
            <div class="upload-icon-large">üìÑ</div>
            <h3>Arrastra y suelta tu CV aqu√≠</h3>
            <p>Soporta formato PDF (M√°x 10MB)</p>
            <button class="btn btn-primary mt-3" onclick="document.getElementById('cvUpload').click()">Seleccionar Archivo</button>
            <input type="file" id="cvUpload" accept=".pdf" hidden>
          </div>

          <div id="uploadProgress" class="upload-progress hidden">
            <div class="spinner"></div>
            <h3>Analizando tu CV con IA...</h3>
            <div class="progress-bar-container">
              <div class="progress-bar-fill" id="progressBar"></div>
            </div>
            <p id="progressText">Extrayendo experiencia laboral...</p>
          </div>
        </div>

        <!-- PASO 2: VERIFICAR DATOS (Inicialmente Oculto) -->
        <div id="step2-content" class="step-content hidden">
          <div class="text-center mb-4">
            <h2>Verifica tu Informaci√≥n ‚úèÔ∏è</h2>
            <p>Hemos extra√≠do estos datos. Confirma que todo est√© correcto antes de continuar.</p>
          </div>
          
          <div id="extractedDataPlaceholder">
            <!-- Aqu√≠ se mover√° la vista previa de datos cuando se cargue -->
          </div>

          <div class="step-actions">
            <button class="btn btn-secondary" onclick="resetWizard()">Subir otro CV</button>
            <button class="btn btn-primary" id="confirmDataBtn" onclick="goToStep(3)">Confirmar y Continuar ‚Üí</button>
          </div>
        </div>

        <!-- PASO 3: GENERAR PERFILES IA (Inicialmente Oculto) -->
        <div id="step3-content" class="step-content hidden">
          <div class="text-center mb-4">
            <h2>Crea tu Estrategia Profesional ü§ñ</h2>
            <p>Genera 3 variantes de perfil optimizadas para diferentes roles.</p>
          </div>

          <div class="ai-cards-container">
            <div class="ai-intro-card">
              <div class="icon">‚ú®</div>
              <h3>Potencia tu Perfil</h3>
              <p>Nuestra IA analizar√° tu trayectoria y crear√° perfiles enfocados en tus fortalezas.</p>
              <button class="btn btn-primary btn-lg" onclick="generateProfiles()">Generar Perfiles Ahora</button>
            </div>
          </div>
          
          <div id="aiProfilesResult" class="hidden">
             <!-- Aqu√≠ se inyectar√°n los perfiles generados -->
          </div>

          <div class="step-actions hidden" id="finalActions">
            <button class="btn btn-secondary" onclick="goToStep(2)">‚Üê Volver</button>
            <button class="btn btn-success" onclick="finishWizard()">Finalizar y Guardar</button>
          </div>
        </div>

      </section>

      <!-- Upload Section -->
      <section id="upload" class="section hidden">
        <div class="section-header">
          <h2>üìÑ Subir CV en PDF</h2>
          <p>Sube tu CV y extraeremos autom√°ticamente tu informaci√≥n</p>
        </div>

        <div class="upload-container">
          <div class="upload-area" id="uploadArea">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
              <path d="M21 15V19C21 19.5304 20.7893 20.0391 20.4142 20.4142C20.0391 20.7893 19.5304 21 19 21H5C4.46957 21 3.96086 20.7893 3.58579 20.4142C3.21071 20.0391 3 19.5304 3 19V15" stroke="currentColor" stroke-width="2"/>
              <path d="M17 8L12 3L7 8" stroke="currentColor" stroke-width="2"/>
              <path d="M12 3V15" stroke="currentColor" stroke-width="2"/>
            </svg>
            <h3>Arrastra tu CV aqu√≠</h3>
            <p>o haz click para seleccionar</p>
            <span class="file-types">PDF ‚Ä¢ M√°ximo 10MB</span>
            <input type="file" id="cvFile" accept=".pdf" hidden>
          </div>

          <div id="uploadProgress" class="upload-progress hidden">
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="uploadStatus">Procesando...</p>
          </div>

          <!-- Extracted Data Preview - Editable -->
          <div id="extractedDataPreview" class="extracted-data-preview hidden">
            <div class="preview-header">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="#22c55e" stroke-width="2"/>
                <path d="M9 12L11 14L15 10" stroke="#22c55e" stroke-width="2"/>
              </svg>
              <h3>üìã Datos Extra√≠dos del CV</h3>
              <p>Revisa y edita la informaci√≥n antes de guardar</p>
            </div>

            <div class="extracted-data-form">
              <!-- Personal Info -->
              <div class="data-section">
                <h4>üë§ Informaci√≥n Personal</h4>
                <div class="data-fields">
                  <div class="data-field">
                    <label>Nombre</label>
                    <input type="text" id="extracted-firstName" class="editable-field">
                    <span class="field-status"></span>
                  </div>
                  <div class="data-field">
                    <label>Apellido</label>
                    <input type="text" id="extracted-lastName" class="editable-field">
                    <span class="field-status"></span>
                  </div>
                  <div class="data-field">
                    <label>Email</label>
                    <input type="email" id="extracted-email" class="editable-field">
                    <span class="field-status"></span>
                  </div>
                  <div class="data-field">
                    <label>Tel√©fono</label>
                    <input type="tel" id="extracted-phone" class="editable-field">
                    <span class="field-status"></span>
                  </div>
                </div>
              </div>

              <!-- Professional Info -->
              <div class="data-section">
                <h4>üíº Informaci√≥n Profesional</h4>
                <div class="data-fields">
                  <div class="data-field">
                    <label>T√≠tulo Profesional</label>
                    <input type="text" id="extracted-currentTitle" class="editable-field">
                    <span class="field-status"></span>
                  </div>
                  <div class="data-field">
                    <label>Ciudad</label>
                    <input type="text" id="extracted-city" class="editable-field">
                    <span class="field-status"></span>
                  </div>
                  <div class="data-field">
                    <label>Pa√≠s</label>
                    <input type="text" id="extracted-country" class="editable-field">
                    <span class="field-status"></span>
                  </div>
                  <div class="data-field">
                    <label>LinkedIn</label>
                    <input type="url" id="extracted-linkedin" class="editable-field">
                    <span class="field-status"></span>
                  </div>
                </div>
              </div>



              <!-- Experience -->
              <div class="data-section">
                <div class="section-title-with-button">
                  <h4>üíº Experiencia Profesional</h4>
                  <button type="button" class="btn-add-item" id="addExperience">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Agregar Experiencia
                  </button>
                </div>
                <div id="extractedExperienceList" class="extracted-experience-list"></div>
              </div>

              <!-- Education -->
              <div class="data-section">
                <div class="section-title-with-button">
                  <h4>üéì Educaci√≥n</h4>
                  <button type="button" class="btn-add-item" id="addEducation">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                      <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    Agregar Educaci√≥n
                  </button>
                </div>
                <div id="extractedEducationList" class="extracted-education-list"></div>
              </div>

              <!-- Skills -->
              <div class="data-section">
                <h4>üéØ Habilidades Detectadas</h4>
                <div id="extractedSkillsList" class="extracted-skills-list"></div>
                <p class="hint-text">Haz click en una habilidad para eliminarla, o agrega m√°s en el perfil</p>
              </div>

              <!-- Summary Stats -->
              <div class="extraction-stats">
                <div class="stat-item">
                  <span class="stat-icon">‚úÖ</span>
                  <span class="stat-text"><strong id="fieldsExtracted">0</strong> campos detectados</span>
                </div>
                <div class="stat-item">
                  <span class="stat-icon">üìù</span>
                  <span class="stat-text"><strong id="fieldsEdited">0</strong> campos editados</span>
                </div>
              </div>

              <!-- Actions -->
              <div class="preview-actions">
                <button type="button" class="btn btn-secondary" id="discardExtraction">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2"/>
                  </svg>
                  Descartar
                </button>
                <button type="button" class="btn btn-primary" id="saveExtractedData">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2"/>
                  </svg>
                  Guardar y Continuar
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Profile Section -->
      <section id="profile" class="section hidden">
        <div class="section-header">
          <h2>üë§ Mi Perfil</h2>
          <p>Completa tu informaci√≥n para autocompletar formularios</p>
        </div>

        <form id="profileForm" class="profile-form">
          <!-- Personal Information -->
          <div class="form-section">
            <h3>Informaci√≥n Personal</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">Nombre *</label>
                <input type="text" id="firstName" name="firstName" required>
              </div>
              <div class="form-group">
                <label for="lastName">Apellido *</label>
                <input type="text" id="lastName" name="lastName" required>
              </div>
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" required>
              </div>
              <div class="form-group">
                <label for="phone">Tel√©fono</label>
                <input type="tel" id="phone" name="phone">
              </div>
            </div>

            <div class="form-group">
              <label for="currentTitle">T√≠tulo Profesional</label>
              <input type="text" id="currentTitle" name="currentTitle" placeholder="ej: Full Stack Developer">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="city">Ciudad</label>
                <input type="text" id="city" name="city">
              </div>
              <div class="form-group">
                <label for="country">Pa√≠s</label>
                <input type="text" id="country" name="country">
              </div>
            </div>

            <div class="form-group">
              <label for="address">Direcci√≥n</label>
              <input type="text" id="address" name="address">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="linkedin">LinkedIn</label>
                <input type="url" id="linkedin" name="linkedin" placeholder="https://linkedin.com/in/tu-perfil">
              </div>
              <div class="form-group">
                <label for="portfolio">Portfolio/Website</label>
                <input type="url" id="portfolio" name="portfolio" placeholder="https://tu-sitio.com">
              </div>
            </div>

            <div class="form-group">
              <label for="summary">Resumen Profesional</label>
              <textarea id="summary" name="summary" rows="4" placeholder="Describe brevemente tu experiencia y objetivos profesionales..."></textarea>
            </div>
          </div>

          <!-- Skills -->
          <div class="form-section">
            <h3>Habilidades</h3>
            <div class="skills-input">
              <input type="text" id="skillInput" placeholder="Agrega una habilidad y presiona Enter">
              <div id="skillsList" class="skills-list"></div>
            </div>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" id="resetForm">Limpiar</button>
            <button type="submit" class="btn btn-primary">Guardar Perfil</button>
          </div>
        </form>
      </section>
    </div>
  </main>

  <!-- Profiles Modal -->
  <div id="profilesModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content profiles-modal-content">
      <div class="modal-header">
        <div class="modal-title-section">
          <h2>ü§ñ Perfiles Profesionales Generados</h2>
          <p>Selecciona el perfil con el que deseas buscar trabajo</p>
        </div>
        <button class="modal-close" id="closeProfilesModal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>

      <!-- Loading State -->
      <div id="profilesLoading" class="profiles-loading">
        <div class="loading-spinner"></div>
        <p>Generando perfiles profesionales con IA...</p>
        <span class="loading-hint">Esto puede tomar unos segundos</span>
      </div>

      <!-- Error State -->
      <div id="profilesError" class="profiles-error hidden">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2"/>
          <path d="M12 8V12M12 16H12.01" stroke="#ef4444" stroke-width="2"/>
        </svg>
        <h3>Error al generar perfiles</h3>
        <p id="profilesErrorMessage"></p>
        <div class="error-actions">
          <button class="btn btn-secondary" id="configureApiKey">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              <path d="M12 1V3M12 21V23M4.22 4.22L5.64 5.64M18.36 18.36L19.78 19.78M1 12H3M21 12H23M4.22 19.78L5.64 18.36M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2"/>
            </svg>
            Configurar API Key
          </button>
          <button class="btn btn-primary" id="retryGenerateProfiles">
            Intentar de nuevo
          </button>
        </div>
      </div>

      <!-- Profiles Grid -->
      <div id="profilesGrid" class="profiles-grid hidden">
        <!-- Profile cards will be inserted here dynamically -->
      </div>

      <!-- Modal Footer -->
      <div id="profilesFooter" class="modal-footer hidden">
        <div class="footer-info">
          <span class="info-icon">üí°</span>
          <span>Puedes cambiar de perfil en cualquier momento desde tu dashboard</span>
        </div>
      </div>
    </div>
  </div>

  <!-- API Key Configuration Modal -->
  <div id="apiKeyModal" class="modal hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content api-key-modal-content">
      <div class="modal-header">
        <div class="modal-title-section">
          <h2>‚öôÔ∏è Configurar API Key de Groq</h2>
          <p>Ingresa tu API key para habilitar la generaci√≥n de perfiles con IA</p>
        </div>
        <button class="modal-close" id="closeApiKeyModal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>
      </div>

      <div class="api-key-form">
        <div class="form-group">
          <label for="groqApiKeyInput">API Key de Groq</label>
          <input 
            type="password" 
            id="groqApiKeyInput" 
            class="api-key-input" 
            placeholder="gsk_..." 
            autocomplete="off"
          />
          <button type="button" class="toggle-visibility" id="toggleApiKeyVisibility">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M1 12S5 4 12 4s11 8 11 8-4 8-11 8S1 12 1 12z" stroke="currentColor" stroke-width="2"/>
              <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
            </svg>
          </button>
        </div>

        <div class="api-key-info">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="#3b82f6" stroke-width="2"/>
            <path d="M12 16V12M12 8H12.01" stroke="#3b82f6" stroke-width="2"/>
          </svg>
          <div>
            <p><strong>¬øD√≥nde obtener tu API Key?</strong></p>
            <ol>
              <li>Visita <a href="https://console.groq.com" target="_blank">console.groq.com</a></li>
              <li>Crea una cuenta gratuita</li>
              <li>Ve a "API Keys" y genera una nueva key</li>
              <li>Copia y pega la key aqu√≠</li>
            </ol>
          </div>
        </div>

        <div class="api-key-actions">
          <button class="btn btn-secondary" id="cancelApiKey">
            Cancelar
          </button>
          <button class="btn btn-primary" id="saveApiKey">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M5 13L9 17L19 7" stroke="currentColor" stroke-width="2"/>
            </svg>
            Guardar y Continuar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Scripts -->
  <script src="js/app.js?v=3.0"></script>
</body>
</html>
